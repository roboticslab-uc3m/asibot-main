language: cpp
dist: trusty
sudo: required

os:
  - linux

compiler:
  - gcc
  - clang

before_install:
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get update; fi

  #-- Configure Git (needed by YCM)
  - if [ ! `git config --get user.email` ]; then `git config --global user.email 'user@example.com'`; fi
  - if [ ! `git config --get user.name` ]; then `git config --global user.name 'Travis CI'`; fi

  #-- Install YARP and KDL deps
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install libeigen3-dev; fi  # Needed for creating YARP lib_math

  #-- Install OpenRAVE deps
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install libboost-all-dev; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install libqt4-dev qt4-dev-tools libxml2-dev libode-dev; fi # libfcl-dev not on Trusty used in this travis
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install libsoqt4-dev libcoin80-dev; fi

install:
  #-- Install YARP
  - git clone https://github.com/robotology/yarp
  - cd yarp && mkdir build && cd "$_"
  - cmake .. -DSKIP_ACE=ON
  - make -j$(nproc)
  - sudo make install
  - cd ../..

  #-- Install KDL
  - git clone https://github.com/orocos/orocos_kinematics_dynamics
  - cd orocos_kinematics_dynamics/orocos_kdl && mkdir build && cd "$_"
  - cmake ..
  - make -j$(nproc)
  - sudo make install
  - cd ../../..

  #-- Install OpenRAVE
  - git clone --branch latest_stable https://github.com/rdiankov/openrave.git
  - cd openrave && mkdir build && cd "$_"
  - cmake .. -DOPENRAVE_PLUGIN_FCLRAVE=OFF
  - make -j$(nproc)
  - sudo make install
  - cd ../..

before_script:
  - mkdir build && cd "$_"
  - cmake ..

script:
  - make
  - sudo make install
  - sudo ldconfig

after_success:
  - sudo make uninstall
